# QB种子优化插件功能总结

## 插件概述

QB种子优化插件是一个专门为MoviePilot V2设计的qBittorrent种子管理优化工具，旨在提高下载效率和种子质量。

## 核心功能

### 1. 清理无人做种的种子
- **功能描述**：自动检测并删除做种数为0的下载任务
- **触发条件**：种子处于下载状态且做种数≤设定阈值（没有人提供做种）
- **操作方式**：删除种子（保留文件）+ 尝试重新搜索下载
- **安全机制**：避免删除标记为重要的种子
- **配置参数**：无人做种阈值（默认0）

### 2. 提升有人做种的下载优先级
- **功能描述**：为做种数较多的下载任务提升优先级，优先下载有人做种的资源
- **触发条件**：种子处于下载状态且做种数≥设定阈值（有人提供做种）
- **操作方式**：设置更高的下载优先级（1-7级）
- **配置参数**：有人做种阈值（默认10）、优先级提升倍数（默认2）

### 3. 清理下载超时种子
- **功能描述**：删除下载时间过长的种子
- **触发条件**：种子处于下载状态且下载时间>设定天数
- **操作方式**：删除种子和文件
- **安全机制**：避免删除标记为重要的种子
- **配置参数**：下载超时天数（默认7天）

## 技术特性

### 安全机制
- **重要种子保护**：通过标签、名称关键词、分享率等判断种子重要性
- **保守处理**：出错时默认不删除种子
- **详细日志**：记录所有操作过程

### 配置灵活
- **功能开关**：可独立启用/禁用各项功能
- **参数可调**：所有阈值和参数都可自定义
- **多下载器支持**：支持配置多个qBittorrent实例

### 监控通知
- **状态监控**：实时查看种子状态统计
- **操作通知**：执行操作后发送通知消息
- **交互命令**：支持手动触发和状态查询

## 文件结构

```
plugins.v2/qboptimizer/
├── __init__.py          # 插件主文件（803行）
├── README.md           # 详细使用说明
├── INSTALL.md          # 安装指南
├── SUMMARY.md          # 功能总结（本文件）
├── simple_test.py      # 简化测试脚本
└── test_plugin.py      # 完整测试脚本
```

## 配置界面

插件提供完整的Web配置界面，包括：

### 基础配置
- 启用插件开关
- 通知设置
- 下载器选择
- 执行周期设置（Cron表达式）
- 立即运行选项

### 功能开关
- 清理无人做种的种子
- 提升有人做种的下载优先级
- 清理下载超时种子

### 参数配置
- 无人做种阈值
- 有人做种阈值
- 下载超时天数
- 优先级提升倍数

## 交互命令

- `/qb_optimize` - 执行QB种子优化
- `/qb_status` - 查看QB优化状态

## 使用建议

### 推荐配置
- **执行周期**：`0 */6 * * *`（每6小时执行一次）
- **无人做种阈值**：0（清理无人做种的下载任务）
- **有人做种阈值**：10（提升做种数≥10的种子下载优先级）
- **超时天数**：7（清理下载超过7天的种子）

### 安全建议
1. 首次使用建议先启用通知功能
2. 可以先使用"立即运行一次"测试效果
3. 重要种子建议添加"important"标签
4. 定期检查日志确保功能正常

### 性能优化
1. 避免设置过于频繁的执行周期
2. 合理设置阈值参数
3. 监控系统资源使用情况

## 版本信息

- **版本**：v1.0
- **作者**：Assistant
- **兼容性**：MoviePilot V2
- **依赖**：qBittorrent下载器

## 后续开发计划

1. **重新下载功能**：集成MoviePilot搜索API实现自动重新下载
2. **更多下载器支持**：扩展支持Transmission等其他下载器
3. **智能优化算法**：基于历史数据优化参数设置
4. **Web界面增强**：添加实时监控和统计图表

## 技术支持

- 查看README.md获取详细使用说明
- 运行测试脚本检查插件状态
- 查看MoviePilot日志获取错误信息
- 提交Issue到项目仓库获取帮助
