# QB种子优化插件调试指南

## 日志系统概述

插件已经增加了详细的日志输出，方便调试和监控。所有日志都带有 `【QB种子优化】` 前缀，便于在日志文件中快速定位。

## 日志级别说明

### INFO 级别日志
- 插件初始化信息
- 配置加载详情
- 主要操作步骤
- 统计信息
- 操作结果

### DEBUG 级别日志
- 详细的检查过程
- 种子属性信息
- 条件判断详情
- 内部状态信息

### WARNING 级别日志
- 配置问题
- 非致命错误
- 跳过操作的原因

### ERROR 级别日志
- 操作失败
- 异常信息
- 完整的堆栈跟踪

## 主要日志输出点

### 1. 插件初始化
```
【QB种子优化】开始初始化插件...
【QB种子优化】收到配置: {...}
【QB种子优化】配置加载完成:
  - 启用状态: True
  - 立即运行: False
  - 发送通知: True
  - 下载器: ['qbittorrent']
  - 执行周期: 0 */6 * * *
  - 清理做种数为0: True
  - 提升优先级: True
  - 清理超时: True
  - 做种数阈值: 0
  - 高优先级阈值: 10
  - 超时天数: 7
  - 优先级倍数: 2
```

### 2. 服务连接检查
```
【QB种子优化】获取服务信息，配置的下载器: ['qbittorrent']
【QB种子优化】开始获取下载器服务...
【QB种子优化】获取到的服务: ['qbittorrent']
【QB种子优化】检查下载器: qbittorrent
【QB种子优化】下载器 qbittorrent 连接正常
【QB种子优化】活跃下载器数量: 1
```

### 3. 种子优化执行
```
【QB种子优化】开始执行种子优化任务...
【QB种子优化】配置的下载器: ['qbittorrent']
【QB种子优化】开始处理下载器: qbittorrent
【QB种子优化】开始获取种子列表: qbittorrent
【QB种子优化】下载器:qbittorrent种子总数: 150
【QB种子优化】下载中: 5, 做种中: 145
【QB种子优化】开始执行优化操作...
```

### 4. 清理做种数为0的种子
```
【QB种子优化】开始清理做种数为0的种子，功能开关: True
【QB种子优化】检查条件: 做种数阈值=0
【QB种子优化】检查种子 1/150: Movie.Name.2023.1080p.BluRay.x264
【QB种子优化】种子符合条件: Movie.Name.2023.1080p.BluRay.x264
  - 状态: uploading
  - 做种数: 0
  - 分享率: 1.5
【QB种子优化】添加待清理种子: Movie.Name.2023.1080p.BluRay.x264
【QB种子优化】检查完成，发现3个做种数为0的种子
【QB种子优化】开始删除做种数为0的种子...
【QB种子优化】删除种子 1/3: Movie.Name.2023.1080p.BluRay.x264
  - 做种数: 0
  - 分享率: 1.5
  - 大小: 8.5 GB
【QB种子优化】删除种子成功: Movie.Name.2023.1080p.BluRay.x264
```

### 5. 提升优先级
```
【QB种子优化】开始提升高做种数种子优先级，功能开关: True
【QB种子优化】检查条件: 高优先级做种数阈值=10
【QB种子优化】种子符合条件: Another.Movie.2023.1080p.BluRay.x264
  - 状态: downloading
  - 做种数: 15
  - 当前优先级: 1
【QB种子优化】设置优先级: 1 -> 2
【QB种子优化】提升优先级成功: Another.Movie.2023.1080p.BluRay.x264
```

### 6. 清理超时种子
```
【QB种子优化】开始清理下载超时种子，功能开关: True
【QB种子优化】检查条件: 超时天数=7天, 超时秒数=604800秒
【QB种子优化】种子下载时间: Old.Movie.2023.1080p.BluRay.x264
  - 添加时间: 1640995200
  - 当前时间: 1641600000
  - 下载时间: 604800秒 (7.0天)
  - 超时阈值: 604800秒 (7天)
【QB种子优化】种子超时: Old.Movie.2023.1080p.BluRay.x264
【QB种子优化】删除超时种子 1/2: Old.Movie.2023.1080p.BluRay.x264
  - 下载时间: 7.0天
  - 大小: 12.3 GB
【QB种子优化】删除超时种子成功: Old.Movie.2023.1080p.BluRay.x264
```

### 7. 状态查询
```
【QB种子优化】开始显示状态...
【QB种子优化】检查下载器状态: qbittorrent
【QB种子优化】获取种子列表: qbittorrent
【QB种子优化】种子列表获取成功: qbittorrent, 总数: 150
【QB种子优化】qbittorrent 详细统计:
  - 总种子数: 150
  - 下载中: 5
  - 做种中: 145
  - 做种数为0 (阈值≤0): 3
  - 高做种数 (阈值≥10): 8
【QB种子优化】做种数为0的种子详情:
  1. Movie.Name.2023.1080p.BluRay.x264 (做种数: 0, 分享率: 1.5)
  2. Another.Movie.2023.1080p.BluRay.x264 (做种数: 0, 分享率: 2.1)
  3. Third.Movie.2023.1080p.BluRay.x264 (做种数: 0, 分享率: 0.8)
```

## 调试技巧

### 1. 查看完整日志
```bash
# 查看MoviePilot日志文件
tail -f /path/to/moviepilot/logs/moviepilot.log | grep "【QB种子优化】"
```

### 2. 启用DEBUG级别日志
在MoviePilot配置中设置日志级别为DEBUG，可以看到更详细的调试信息。

### 3. 监控特定操作
```bash
# 监控种子优化操作
grep "【QB种子优化】开始执行种子优化任务" /path/to/moviepilot.log

# 监控删除操作
grep "【QB种子优化】删除种子" /path/to/moviepilot.log

# 监控错误信息
grep "【QB种子优化】.*ERROR" /path/to/moviepilot.log
```

### 4. 检查配置问题
```bash
# 查看配置加载日志
grep "【QB种子优化】配置加载完成" /path/to/moviepilot.log

# 查看下载器连接状态
grep "【QB种子优化】下载器.*连接" /path/to/moviepilot.log
```

## 常见问题排查

### 1. 插件未执行
检查日志中是否有：
- 插件初始化信息
- 配置加载信息
- 调度器启动信息

### 2. 下载器连接失败
检查日志中是否有：
- 下载器连接状态
- 服务获取失败信息
- 错误详情

### 3. 种子操作失败
检查日志中是否有：
- 种子获取失败
- 删除操作失败
- 优先级设置失败
- 异常堆栈信息

### 4. 配置问题
检查日志中是否有：
- 配置参数值
- 功能开关状态
- 阈值设置

## 日志文件位置

- **MoviePilot日志**: `/path/to/moviepilot/logs/moviepilot.log`
- **系统日志**: `/var/log/syslog` (Linux) 或 `/var/log/system.log` (macOS)

## 性能监控

通过日志可以监控：
- 插件执行频率
- 种子处理数量
- 操作耗时
- 错误率

## 注意事项

1. **日志级别**: 生产环境建议使用INFO级别，调试时使用DEBUG级别
2. **日志轮转**: 注意日志文件大小，避免占用过多磁盘空间
3. **敏感信息**: 日志中可能包含种子名称等敏感信息，注意保护隐私
4. **性能影响**: 过多的DEBUG日志可能影响性能，调试完成后建议调整级别
