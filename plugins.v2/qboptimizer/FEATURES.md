# QB种子优化插件功能说明

## 核心功能概述

QB种子优化插件专门针对qBittorrent下载器设计，通过智能管理种子来优化下载效率和资源利用率。插件包含四个核心功能，每个功能都有独立的开关和参数配置。

## 功能一：清理无人做种的种子

### 功能描述
自动检测并删除做种数为0的下载任务，避免无效下载占用下载槽位和带宽资源。

### 工作原理
1. **检测条件**：种子处于下载状态且做种数≤设定阈值（默认0）
2. **判断逻辑**：如果没有人提供做种，说明这个种子无法下载完成
3. **操作流程**：
   - 记录种子信息（名称、大小、分类、标签等）
   - 删除种子（保留已下载的文件）
   - 尝试重新搜索下载新的资源

### 配置参数
- **无人做种阈值**：做种数为0的判定阈值（默认0）
- **功能开关**：可独立启用/禁用该功能

### 使用场景
- 种子发布者停止做种
- 种子文件被删除或失效
- 网络连接问题导致无法获取做种信息

### 安全机制
- 避免删除标记为重要的种子
- 保留已下载的文件
- 详细记录操作日志

## 功能二：提升有人做种的下载优先级

### 功能描述
为做种数较多的下载任务提升优先级，优先下载有人做种的资源，提高下载成功率。

### 工作原理
1. **检测条件**：种子处于下载状态且做种数≥设定阈值（默认10）
2. **判断逻辑**：做种数多说明资源可用性高，下载成功率大
3. **操作流程**：
   - 按做种数对种子进行排序
   - 做种数最多的设为最高优先级1
   - 依次递减设置优先级（1-7级）

### 配置参数
- **有人做种阈值**：触发优先级提升的做种数阈值（默认10）
- **功能开关**：可独立启用/禁用该功能

### 使用场景
- 多个下载任务同时进行时
- 需要优先下载热门资源
- 带宽有限需要合理分配

### 优先级说明
- qBittorrent优先级范围：1-7级
- 1级：最高优先级（做种数最多的种子）
- 7级：最低优先级
- 按做种数排序，做种数最多的优先级最高

## 功能三：清理下载超时种子

### 功能描述
删除下载时间过长的种子，释放下载槽位，避免资源浪费。

### 工作原理
1. **检测条件**：种子处于下载状态且下载时间>设定天数（默认7天）
2. **判断逻辑**：长时间无法下载完成的种子可能是死种或网络问题
3. **操作流程**：
   - 计算种子下载时间
   - 删除种子和已下载的文件
   - 释放下载槽位

### 配置参数
- **下载超时天数**：种子下载超时的天数阈值（默认7天）
- **功能开关**：可独立启用/禁用该功能

### 使用场景
- 种子长期无法下载完成
- 网络连接问题导致下载停滞
- 需要释放下载槽位给新任务

### 安全机制
- 避免删除标记为重要的种子
- 详细记录删除原因
- 提供操作确认和通知

## 功能四：自动重新下载

### 功能描述
在清理无人做种的种子后，自动搜索并下载更好的替代种子，实现无缝的种子替换。

### 工作原理
1. **种子名称处理**：提取核心关键词，去除质量信息、编码格式、发布组等
2. **智能搜索**：使用MoviePilot搜索API在多个站点搜索替代种子
3. **质量评估**：根据做种数、大小相似度等指标评估候选种子
4. **自动下载**：选择最佳种子并自动添加到下载队列

### 配置参数
- **启用自动重新下载**：控制是否启用自动重新下载功能（默认启用）
- **搜索页数**：控制搜索的页数范围（默认3页）
- **评分权重**：做种数权重最高，大小相似度次之

### 使用场景
- 种子发布者停止做种导致下载失败
- 原始种子质量较低，需要寻找更好的替代品
- 自动化种子管理，减少手动操作

### 安全机制
- 避免下载做种数为0的种子
- 保持原有分类和标签信息
- 详细记录搜索和下载过程
- 支持手动禁用自动重新下载

## 功能组合使用

### 推荐配置
```json
{
  "enable_zero_seed_clean": true,
  "enable_priority_boost": true,
  "enable_timeout_clean": true,
  "enable_auto_redownload": true,
  "zero_seed_threshold": 0,
  "priority_seed_threshold": 10,
  "timeout_days": 7,
  # 移除优先级提升倍数配置
}
```

### 执行流程
1. **清理无人做种**：删除无法下载的种子，释放资源
2. **自动重新下载**：搜索并下载替代种子
3. **提升优先级**：为有希望的种子提升下载优先级
4. **清理超时**：删除长期无法完成的种子

### 优化效果
- **提高下载成功率**：优先下载有人做种的资源
- **减少资源浪费**：及时清理无效种子
- **自动种子替换**：无缝替换失效种子
- **优化下载队列**：合理分配下载优先级
- **释放系统资源**：清理超时种子释放槽位

## 监控和日志

### 详细日志
每个功能都提供详细的日志输出，包括：
- 操作开始和结束时间
- 处理的种子数量和详情
- 操作结果和错误信息
- 性能统计和耗时

### 状态监控
- 实时查看种子状态统计
- 监控功能执行效果
- 跟踪优化前后对比

### 通知系统
- 操作完成后发送通知
- 包含处理结果统计
- 支持多种通知渠道

## 安全考虑

### 数据保护
- 重要种子保护机制
- 操作前备份种子信息
- 支持操作回滚

### 配置验证
- 参数范围检查
- 功能开关验证
- 下载器连接测试

### 错误处理
- 异常捕获和处理
- 详细错误日志
- 优雅降级机制

## 扩展性

### 未来功能
- 支持更多下载器类型（Transmission、Aria2等）
- 智能参数优化算法
- Web界面实时监控
- 机器学习优化种子选择

### 自定义扩展
- 支持自定义种子判断规则
- 可扩展的通知渠道
- 灵活的配置参数
- 插件化架构设计
